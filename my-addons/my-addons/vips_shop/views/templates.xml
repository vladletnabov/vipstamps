<openerp>
    <data>

        <template id="assets_backend" name="vips_shop assets" inherit_id="website.assets_frontend">
          <xpath expr="." position="inside">
              <script src="/vips_shop/static/src/js/website_sale_ext.js" type="text/javascript"></script>

          </xpath>
      </template>



<template id="checkout">
  <t t-call="website.layout">
    <t t-set="additional_title">Проверка заказа</t>
    <div id="wrap">
      <div class="container oe_website_sale">
          <ul class="wizard pull-right">
              <li><a href="/shop/cart" class="text-success">Просмотр<span class="chevron"></span></a></li>
              <li class="text-primary">Доставка &amp; счета<span class="chevron"></span></li>
              <li class="text-muted">Оплата<span class="chevron"></span></li>
              <li class="text-muted">Подтверждение<span class="chevron"></span></li>
          </ul>
          <h1>Ваши контактные данные</h1>
          <form action="/shop/confirm_order" method="post">

          <div class="row">
          <div class="col-md-8 oe_cart">
              <h3 class="page-header mt16">Информация о заказе
                  <small groups="base.group_public"> or
                      <a class='btn btn-primary' t-if="not partner" t-attf-href="/web?redirect=#{ request.httprequest.url }">Войти</a>
                  </small>
              </h3>
              <div class="row">
                  <div t-attf-class="form-group #{error.get('name') and 'has-error' or ''} col-lg-6">
                      <label class="control-label" for="contact_name">Ваше имя</label>
                      <input type="text" name="name" class="form-control" t-att-value="checkout.get('name')"/>
                  </div>
                  <div t-if="has_check_vat" class="clearfix"/>
                  <div t-attf-class="form-group #{error.get('street') and 'has-error' or ''} col-lg-6">
                      <label class="control-label" for="street" style="font-weight: normal">Название компании</label>
                      <input type="text" name="street" class="form-control" t-att-value="checkout.get('street')"/>
                  </div>
                  <div t-if="has_check_vat" t-attf-class="form-group #{error.get('vat') and 'has-error' or ''} col-lg-6">
                      <label class="control-label" for="vat" style="font-weight: normal">ИНН</label>
                      <input type="text" name="vat" class="form-control" t-att-value="checkout.get('vat')"/>
                  </div>
                  <div t-attf-class="form-group #{error.get('email') and 'has-error' or ''} col-lg-6">
                      <label class="control-label" for="contact_name">Email</label>
                      <input type="email" name="email" class="form-control" t-att-value="checkout.get('email')"/>
                  </div>
                  <div t-attf-class="form-group #{error.get('phone') and 'has-error' or ''} col-lg-6">
                      <label class="control-label" for="phone">Контактный телефон</label>
                      <input type="tel" name="phone" class="form-control" t-att-value="checkout.get('phone')"/>
                  </div>

                  <div t-attf-class="form-group #{error.get('street2') and 'has-error' or ''} col-lg-6">
                      <label class="control-label" for="street2">Улица, дом, квартира/офис</label>
                      <input type="text" name="street2" class="form-control" t-att-value="checkout.get('street2')"/>
                  </div>

                  <div t-attf-class="form-group #{error.get('metro_stations') and 'has-error' or ''} col-lg-6">
                      <label class="control-label" for="metro_id">Станция метро</label>
                      <select name="metro_id" class="form-control">
                          <!--<t t-esc="station_id"/>-->
                          <option value="">Выберите станцию метро...</option>
                          <t t-foreach="metro_stations or []" t-as="metro">
                              <option t-att-value="metro.name" t-att-selected="metro.id == station_id"><t t-esc="metro.name"/></option>
                          </t>
                      </select>
                  </div>


                  <div class="clearfix"/>

                  <div t-attf-class="form-group #{error.get('city') and 'has-error' or ''} col-lg-6">
                      <label class="control-label" for="city">Город</label>
                      <input type="text" name="city" class="form-control" t-att-value="checkout.get('city')"/>
                  </div>
                  <div t-attf-class="form-group #{error.get('zip') and 'has-error' or ''} col-lg-6">
                      <label class="control-label" for="zip" style="font-weight: normal">Почтовый индекс</label>
                      <input type="text" name="zip" class="form-control" t-att-value="checkout.get('zip')"/>
                  </div>
                  <div t-attf-class="form-group #{error.get('country_id') and 'has-error' or ''} col-lg-6">
                      <label class="control-label" for="country_id">Страна</label>
                      <select name="country_id" class="form-control">
                          <option value="">Страна...</option>
                          <t t-foreach="countries or []" t-as="country">
                              <!--<option t-att-value="country.id" t-att-selected="country.id == checkout.get('country_id')"><t t-esc="country.name"/></option>-->
                              <option t-att-value="country.id" t-att-selected="country.code == 'RU'"><t t-esc="country.name"/></option>
                          </t>
                      </select>
                  </div>
                  <div t-attf-class="form-group #{error.get('state_id') and 'has-error' or ''} col-lg-6">
                      <label class="control-label" for="state_id" style="font-weight: normal">Область, штат</label>
                      <select name="state_id" class="form-control">
                          <option value="">Выберите...</option>
                          <t t-foreach="states or []" t-as="state">
                              <option t-att-value="state.id" style="display:none;" t-att-data-country_id="state.country_id.id" t-att-selected="state.id == checkout.get('state_id')"><t t-esc="state.name"/></option>
                          </t>
                      </select>
                  </div>

                  <div class="clearfix"/>
                  <!-- Доставка -->

                  <div class="form-group col-lg-12">
                      <label>Доставка</label>
                      <select id="select_shipping_id" name="shipping_id" class="form-control">
                          <option value="0" t-att-data-shipping_price="delivery_address_product.list_price"
                                  t-att-data-shipping_product_id="delivery_address_product.id">Доставка по адресу</option>
                          <t t-foreach="shippings" t-as="shipping">
                              <!--<t t-set="metro_station_id" t-value="-1"/>
                              <t t-foreach="metro_stations or []" t-as="metro">
                                  <t t-set="metro_station_id" t-value="metro.id"/>
                              </t>-->
                              <option t-att-value="shipping.id" t-att-selected="shipping.id == shipping_id"
                                t-att-data-shipping_name="shipping.name"
                                t-att-data-shipping_phone="shipping.phone"
                                t-att-data-shipping_street="shipping.street"
                                t-att-data-shipping_city="shipping.city"
                                t-att-data-shipping_zip="shipping.zip"
                                t-att-data-shipping_state_id="shipping.state_id and shipping.state_id.id"
                                t-att-data-shipping_country_id="shipping.country_id and shipping.country_id.id"
                                t-att-data-shipping_metro_name="shipping.station_ids.name"
                                t-att-data-shipping_metro_id="shipping.station_ids.id"
                                t-att-data-shipping_price="delivery_address_product.list_price"
                                t-att-data-shipping_product_id="delivery_address_product.id"
                                >Доставка по адресу клиента: <t t-esc="shipping.name"/></option>
                          </t>
                          <t t-foreach="delivery_filail.filial_ids" t-as="shipping">
                              <option t-att-value="shipping.id" t-att-selected="shipping.id == shipping_id"
                                t-att-data-shipping_name="shipping.name"
                                t-att-data-shipping_phone="shipping.phone"
                                t-att-data-shipping_street="shipping.street"
                                t-att-data-shipping_city="shipping.city"
                                t-att-data-shipping_zip="shipping.zip"
                                t-att-data-shipping_state_id="shipping.state_id and shipping.state_id.id"
                                t-att-data-shipping_country_id="shipping.country_id and shipping.country_id.id"
                                t-att-data-shipping_metro_name="shipping.station_ids.name"
                                t-att-data-shipping_metro_id="shipping.station_ids.id"
                                t-att-data-shipping_price="delivery_filial_product.list_price"
                                t-att-data-shipping_product_id="delivery_filial_product.id"
                                >Самовывоз из филиала: <t t-esc="shipping.name"/>, <t t-esc="shipping.station_ids.name"/></option>
                          </t>
                          <option value="-2" t-att-selected="error and len(error) > 0 and shipping_id == -2"
                                  t-att-data-shipping_price="delivery_metro_product.list_price"
                                t-att-data-shipping_product_id="delivery_metro_product.id">Доставка до метро</option>

                          <option value="-1" t-att-selected="error and len(error) > 0 and shipping_id == -1"
                                t-att-data-shipping_price="delivery_address_product.list_price"
                                t-att-data-shipping_product_id="delivery_address_product.id" > Указать новый адрес доставки </option>
                      </select>
                      <input type="hidden" name="shipping_product_id" id="hidden_shipping_product_id" value=""/>
                  </div>
                  <div t-attf-class="form-group col-lg-12"><h3 class="page-header mt16">Стоимость доставки: <small id="delivery_price"><t t-esc="delivery_address_product.list_price"/></small></h3></div>
              </div>
              <div class="js_shipping row mb16" t-att-style="not shipping_id and 'display:none' or ''">
                  <h3 class="oe_shipping col-lg-12 mt16">Информация о доставке</h3>


                  <div t-attf-class="form-group #{error.get('shipping_name') and 'has-error' or ''} col-lg-6">
                      <label class="control-label" for="shipping_name">Имя (для доставки) <t t-esc="checkout.get('shipping_name', '')"/></label>
                      <input type="text" name="shipping_name" class="form-control" t-att-value="checkout.get('shipping_name', '')" t-att-readonly="'readonly' if shipping_id &gt;= 0 else ''"/>
                  </div>
                  <div t-attf-class="form-group #{error.get('shipping_phone') and 'has-error' or ''} col-lg-6">
                      <label class="control-label" for="shipping_phone">Контактный телефон</label>
                      <input type="tel" name="shipping_phone" class="form-control" t-att-value="checkout.get('shipping_phone', '')" t-att-readonly="  'readonly' if shipping_id &gt;= 0 else ''"/>
                  </div>

                  <div t-attf-class="form-group #{error.get('metro_stations') and 'has-error' or ''} col-lg-6">
                      <label class="control-label" for="shipping_metro_id">Станция метро</label>
                      <select name="shipping_metro_id" class="form-control" t-att-disabled="  'disabled' if shipping_id &gt;= 0 else ''">

                          <option value="">Выберите станцию метро...</option>
                          <t t-foreach="metro_stations or []" t-as="metro">
                              <option t-att-value="metro.name"><t t-esc="metro.name"/></option>
                          </t>
                      </select>
                  </div>

                  <div t-attf-class="form-group #{error.get('shipping_street') and 'has-error' or ''} col-lg-6">
                      <label class="control-label" for="shipping_street">Улица, дом, квартира(офис)</label>
                      <input type="text" name="shipping_street" class="form-control" t-att-value="checkout.get('shipping_street', '')" t-att-readonly=" 'readonly' if shipping_id &gt;= 0 else ''"/>
                  </div>
                  <div class="clearfix"/>
                  <div t-attf-class="form-group #{error.get('shipping_city') and 'has-error' or ''} col-lg-6">
                      <label class="control-label" for="shipping_city">Город</label>
                      <input type="text" name="shipping_city" class="form-control" t-att-value="checkout.get('shipping_city', '')" t-att-readonly=" 'readonly' if shipping_id &gt;= 0 else ''"/>
                  </div>
                  <div t-attf-class="form-group #{error.get('shipping_zip') and 'has-error' or ''} col-lg-6">
                      <label class="control-label" for="shipping_zip" style="font-weight: normal">Почтовый индекс</label>
                      <input type="text" name="shipping_zip" class="form-control" t-att-value="checkout.get('shipping_zip', '')" t-att-readonly=" 'readonly' if shipping_id &gt;= 0 else ''"/>
                  </div>
                  <div t-attf-class="form-group #{error.get('shipping_country_id') and 'has-error' or ''} col-lg-6">
                      <label class="control-label" for="shipping_country_id">Страна</label>
                      <select name="shipping_country_id" class="form-control" t-att-disabled="  'disabled' if shipping_id &gt;= 0 else ''">
                          <option value="">Выберите страну...<t esc="checkout.get('shipping_name', '')"/></option>
                          <t t-foreach="countries or []" t-as="country">
                              <option t-att-value="country.id" t-att-selected="country.code == 'RU'"><t t-esc="country.name"/></option>
                          </t>
                      </select>
                  </div>
                  <div t-attf-class="form-group #{error.get('shipping_state_id') and 'has-error' or ''} col-lg-6">
                      <label class="control-label" for="shipping_state_id" style="font-weight: normal">Область / штат</label>
                      <select name="shipping_state_id" class="form-control" t-att-readonly="  'readonly' if shipping_id &gt;= 0 else ''">
                          <option value="">Область / штат...</option>
                          <t t-foreach="states or []" t-as="state">
                              <option t-att-value="state.id" style="display:none;" t-att-data-country_id="state.country_id.id" t-att-selected="state.id == checkout.get('shipping_state_id')"><t t-esc="state.name"/></option>
                          </t>
                      </select>
                  </div>

              </div>

              <div class="js_metro_station_shipping row mb16 " t-att-style="'display:none'">
                  <h3 class="oe_shipping col-lg-12 mt16">Доставка до метро</h3>

                  <div t-attf-class="form-group #{error.get('metro_stations') and 'has-error' or ''} col-lg-6">
                      <label class="control-label" for="shipping_to_metro_id">Станция метро</label>
                      <select name="shipping_to_metro_id" class="form-control" t-att-disabled="  'disabled' if shipping_id &gt;= 0 else ''">

                          <option value="">Выберите станцию метро...</option>
                          <t t-foreach="metro_stations or []" t-as="metro">
                              <option t-att-value="metro.id" ><t t-esc="metro.name"/></option>
                          </t>
                      </select>
                  </div>
              </div>


              <div class="clearfix">
                <a href="/shop/cart" class="btn btn-default mb32"><span class="fa fa-long-arrow-left"/> Назад</a>
                <a class="btn btn-default btn-primary pull-right mb32 a-submit">Подтвердить <span class="fa fa-long-arrow-right"/></a>
              </div>
          </div>
          <div class="col-lg-offset-1 col-lg-3 col-md-3 text-muted">
              <h3 class="page-header mt16">Ваш заказ <small><a href="/shop/cart"><span class="fa fa-arrow-right"/> изменить</a></small></h3>
              <t t-set="website_sale_order" t-value="website.sale_get_order()"/>
              <div class="row"><input name="hidden_sale_order_id" type="hidden" t-att-value="website_sale_order.id"/>
                  <div class="col-sm-6 text-right">Стоимость: </div>
                  <div class="col-sm-6"><span id="order_price_wo_shipping" style="white-space: nowrap;" t-field="website_sale_order.amount_total" t-field-options='{
                      "widget": "monetary",
                      "from_currency": "website_sale_order.pricelist_id.currency_id",
                      "display_currency": "user_id.partner_id.property_product_pricelist.currency_id"
                  }'/></div>
                  <div class="col-sm-6 text-right">Доставка: </div>
                  <div class="col-sm-6"><span id="price_shipping_wo_order" style="white-space: nowrap;" >0.00</span></div>
                  <div class="col-sm-6 text-right">Всего: </div>
                  <div class="col-sm-6"><span id="price_order_with_shipping" style="white-space: nowrap;">0.00</span></div>
                  <!--<div class="col-sm-6 text-right"><h4>К оплате: </h4></div>
                  <div class="col-sm-6"><h4><span style="white-space: nowrap;" t-field="website_sale_order.amount_shipping" t-field-options='{
                      "widget": "monetary",
                      "from_currency": "website_sale_order.sale_order_id",
                      "display_currency": "website_sale_order.sale_order_id"
                  }'/></h4></div>-->
              </div>
          </div>
      </div>
      </form>
    </div>
    </div>
  </t>
</template>
<template id="payment">
  <t t-call="website.layout">
      <t t-set="additional_title">Shop - Select Payment Mode</t>
      <div id="wrap">
        <div class="container oe_website_sale">

          <ul class="wizard pull-right">
              <li><a href="/shop/cart" class="text-success">Review Order<span class="chevron"></span></a></li>
              <li><a href="/shop/checkout" class="text-success">Shipping &amp; Billing<span class="chevron"></span></a></li>
              <li class="text-primary">Payment<span class="chevron"></span></li>
              <li class="text-muted">Confirmation<span class="chevron"></span></li>
          </ul>
          <h1 class="mb32">Validate Order</h1>
          <div class="row">
          <div class="col-lg-8 col-sm-9">
              <t t-foreach="errors" t-as="error">
              <div class="alert alert-danger" t-if="error">
                <h4><t t-esc="error[0]"/></h4>
                <t t-esc="error[1]"/>
              </div>
            </t>
          </div>
          <div class="col-lg-8 col-sm-9 oe_cart">
              <t t-set="website_sale_order" t-value="website.sale_get_order()"/>
              <table class='table table-striped table-condensed' id="cart_products" t-if="website_sale_order and website_sale_order.website_order_line">
                  <thead>
                      <tr>
                          <th colspan="2" width="80">Product</th>
                          <th width="100">Price</th>
                          <th width="120">Quantity</th>
                      </tr>
                  </thead>
                  <tbody>
                      <tr t-foreach="website_sale_order.website_order_line" t-as="line">
                          <td colspan="2" t-if="not line.product_id.product_tmpl_id"></td>
                          <td t-if="line.product_id.product_tmpl_id">
                              <a t-attf-href="/shop/product/#{ slug(line.product_id.product_tmpl_id) }">
                                  <span t-field="line.product_id.image_small"
                                        t-field-options='{"widget": "image", "class": "img-rounded"}'/>
                              </a>
                          </td>
                          <td t-if="line.product_id.product_tmpl_id">
                             <strong t-field="line.product_id.with_context(display_default_code=False).display_name"/>
                          </td>
                          <td class="text-center">
                             <span t-field="line.price_unit" style="white-space: nowrap;" t-field-options='{
                                 "widget": "monetary",
                                 "from_currency": "website_sale_order.pricelist_id.currency_id",
                                 "display_currency": "user_id.partner_id.property_product_pricelist.currency_id"
                             }'/>
                          </td>
                          <td>
                             <div t-esc="line.product_uom_qty"/>
                          </td>
                      </tr>
                  </tbody>
              </table>
              <t t-call="website_sale.total"/>
              <div class="clearfix"/>
              <div class="oe_structure"/>
            </div>
            <div class="col-lg-3 col-lg-offset-1 col-sm-3 text-muted" id="right_column">
                <h4>Bill To:</h4>
                <div t-field="order.partner_invoice_id" t-field-options='{
                    "widget": "contact",
                    "fields": ["address", "name", "phone", "email"]
                    }'/>
                <div>
                  <a href="/shop/checkout"><span class="fa fa-arrow-right"/> Change Address</a>
                </div>
                <t>
                    <h4 class="mt32">Ship To:</h4>
                    <t t-if="website_sale_order.partner_shipping_id and website_sale_order.partner_shipping_id.id != website_sale_order.partner_invoice_id.id">
                      <div t-field="order.partner_shipping_id" t-field-options='{
                        "widget": "contact",
                        "fields": ["address", "name", "phone", "station_ids"]
                        }'/>
                    </t>
                    <address t-if="website_sale_order.partner_shipping_id.id == website_sale_order.partner_invoice_id.id">Ship to the same address</address>
                    <div class="mb32">
                      <a href="/shop/checkout"><span class="fa fa-arrow-right"/> Change Address</a>
                    </div>
                </t>
            </div>
          </div>

          <div class="js_payment mb64 row" t-if="acquirers and website_sale_order.amount_total" id="payment_method">
              <div class="col-lg-5 col-sm-6">
                  <h4>Payment Method:</h4>
                  <ul class="list-unstyled">
                    <li t-foreach="acquirers or []" t-as="acquirer">
                      <label t-if="acquirer.button">
                          <input t-att-value="acquirer.id" type="radio" name="acquirer" t-att-checked="acquirers[0] == acquirer"/>
                          <img class="media-object" style="width: 60px; display: inline-block;"
                              t-att-title="acquirer.name"
                              t-att-src="'/payment_%s/static/src/img/%s_icon.png' % (acquirer.provider, acquirer.provider)"/>
                              <span t-field="acquirer.name"/>
                      </label>
                    </li>
                  </ul>
              </div>
              <div class="col-lg-3 col-sm-3">
                  <t t-foreach="acquirers or []" t-as="acquirer">
                      <div t-att-data-id="acquirer.id" class="oe_sale_acquirer_button hidden pull-right">
                        <div t-raw="acquirer.button"/>
                        <div t-field="acquirer.pre_msg"/>
                      </div>
                  </t>
              </div>
          </div>
          <div class="js_payment mb64 row" t-if="not website_sale_order.amount_total" id="payment_method">
            <div class="col-lg-8 col-sm-8">
              <form target="_self" action="/shop/payment/validate" method="post" class="pull-right">
                  <a style="width:100px;" class="btn btn-primary a-submit">
                    <span>Pay Now <span class="fa fa-long-arrow-right"></span></span>
                  </a>
              </form>
            </div>
          </div>

        </div>
        <div class="oe_structure"/>
      </div>

  </t>
</template>
<template id="mypage">
  <t t-call="website.layout">
    <t t-set="additional_title">Mypage</t>
    <div id="wrap" t-attf-class="#{error.get('station_id') ">
        <p>Station ID: <t esc="mypage.get('station_id')"/></p>
    </div>
  </t>
</template>

        <!-- <template id="listing"> -->
        <!--   <ul> -->
        <!--     <li t-foreach="objects" t-as="object"> -->
        <!--       <a t-attf-href="#{ root }/objects/#{ object.id }"> -->
        <!--         <t t-esc="object.display_name"/> -->
        <!--       </a> -->
        <!--     </li> -->
        <!--   </ul> -->
        <!-- </template> -->
        <!-- <template id="object"> -->
        <!--   <h1><t t-esc="object.display_name"/></h1> -->
        <!--   <dl> -->
        <!--     <t t-foreach="object._fields" t-as="field"> -->
        <!--       <dt><t t-esc="field"/></dt> -->
        <!--       <dd><t t-esc="object[field]"/></dd> -->
        <!--     </t> -->
        <!--   </dl> -->
        <!-- </template> -->
    </data>
</openerp>